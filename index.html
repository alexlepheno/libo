<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maughan Library Book Finder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* A simple animation for the result display */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        /* Styles for the image modal */
        #imageModal {
            transition: background-color 0.3s ease;
        }
        #modalImage {
            transition: transform 0.3s ease;
        }
        @keyframes zoomIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes zoomOut {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(0.5); opacity: 0; }
        }
        .zoom-in { animation: zoomIn 0.3s ease-out forwards; }
        .zoom-out { animation: zoomOut 0.3s ease-in forwards; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl mx-auto">
        <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
            <header class="text-center mb-6">
                <h1 class="text-3xl font-bold text-gray-800">Library Book Finder</h1>
                <p class="text-gray-500 mt-2">Enter a book's classmark to find its location.</p>
            </header>

            <main>
                <div class="flex flex-col md:flex-row gap-3">
                    <input type="text" id="classmarkInput" placeholder="e.g., DD237 or K60" class="flex-grow w-full px-4 py-3 text-lg border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-300" autocomplete="off">
                    <button id="findButton" class="w-full md:w-auto bg-blue-600 text-white font-semibold px-6 py-3 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300">
                        Find
                    </button>
                </div>

                <!-- Status and Result Area -->
                <div id="statusArea" class="text-center mt-4 text-gray-500 min-h-[24px]"></div>
                <div id="resultArea" class="mt-6"></div>
            </main>
        </div>
        <footer class="text-center text-gray-400 text-sm mt-4">
            <p>Data sourced from the Maughan Library browsing guide.</p>
            <p>made by Alexandre Laurent 2025</p>
        </footer>
    </div>

    <!-- Image Modal Structure -->
    <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-0 flex items-center justify-center p-4 z-50 hidden transition-all duration-300">
        <div id="modalContent" class="relative">
             <img id="modalImage" src="" alt="Zoomed floor plan" class="max-w-[90vw] max-h-[90vh] rounded-lg shadow-2xl">
        </div>
    </div>


    <script>
        // --- 1. CONFIGURATION & SETUP ---
        const CSV_DATA = `Subject,Beg,End,Room(s),Floor
[Humanities books] A-D,A1,B 171.A,1.58,1
[Humanities books] A-D,B 171.B,B 491.M,1.57,1
[Humanities books] A-D,B 491.M,BC 80.S,1.58,1
[Humanities books] A-D,BC 91.A,BL 1239.3,1.59,1
[Humanities books] A-D,BL 1241.4,BM 175.2,1.58,1
[Humanities books] A-D,BM 176.S,BM 726.W,1.56,1
[Humanities books] A-D,BM 729.A,BP 163.P,1.55,1
[Humanities books] A-D,BP 163.P,BR 60.C,1.54,1
[Humanities books] A-D,BR 60.C,BS 1545.2,1.55,1
[Humanities books] A-D,BS 1545.3,BS 2543.W,1.56,1
[Humanities books] A-D,BS 2545,BS 2651.P,1M.58,1M
[Humanities books] A-D,BS 2651.R,BT 75.R,1M.59,1M
[Humanities books] A-D,BT 75.S,BT 150.V,1M.58,1M
[Humanities books] A-D,BT 153.F,BT 734.3,1M.56,1M
[Humanities books] A-D,BT 736.H,BT 993.2,1M.55,1M
[Humanities books] A-D,BT 995,BV 5085.U,1M.54,1M
[Humanities books] A-D,BV 5090.F,BX 5141.A,1M.55,1M
[Humanities books] A-D,BX 5141.A,BX 9999,1M.56,1M
[Humanities books] A-D,C1,D 16.8.A,1.66,1
[Humanities books] A-D,D 16.8.B,D 117.C,1.67,1
[Humanities books] A-D,D 117.D,D 208.W,1.69,1
[Humanities books] A-D,D 208.W,D 640.B,1.70,1
[Humanities books] A-D,D 640.C,DA 16.B,1.71,1
[Humanities books] A-D,DA 16.C,DA 170.V,1.70,1
[Humanities books] A-D,DA 170.W,DA 560.D,1.69,1
[Humanities books] A-D,DA 560.E,DA 670.S8,1.68,1
[Humanities books] A-D,DA 670.S9,DD 109,1.67,1
[Humanities books] A-D,DD 110,DE 9999,1.66,1
[Humanities books] A-D,DF1,DF 759.W,1M.72,1M
[Humanities books] A-D,DF 765.A,DF 901.P,1M.71,1M
[Humanities books] A-D,DF 901.R,DG 311.S,1M.70,1M
[Humanities books] A-D,DG 311.W,DG 577.5,1M.69,1M
[Humanities books] A-D,DG 611.5,DJ 9999,1M.68,1M
[Humanities books] A-D,DJK 1,DP 48.F,1M.67,1M
[Humanities books] A-D,DP 48.F,DP 99.W,1M.66,1M
[Humanities books] A-D,DP 101.A,DR 9999,1.13,1
[Humanities books] A-D,DS 1,DS 272.F,1.13,1
[Humanities books] A-D,DS 272.K,DS 771.P,1.14,1
[Humanities books] A-D,DS 771.5,DT 352.5,1M.14,1M
[Humanities books] A-D,DT 352.6,DU 420.M,1M.13,1M
[Law books],HV1,HV 1441.G,1.26,1
[Law books],HV 1444.G,HV 9999,1.25,1
[Law books],HV 6025.0,HV 8197.A,1.24,1
[Law books],HV 1444.G,JX 1963.D,1.25,1
[Law books],JX 1963.D,JX 5531.B,1.26,1
[Law books],JX 5555,K 59.J,1.27,1
[Law books],K 60,K 215.E,1.35,1
[Law books],K 225.B,KBP 9999,1.35,1
[Law books],KBR1,KD 1480.W,1.36,1
[Law books],KD 1487,KD 5424.5,1.37,1
[Law books],KD 5429.M,KI 31.V,1.38,1
[Law books],KI 32.B,KJE 5156.Z,1.37,1
[Law books],KJE 5170.B,KLB 9999,1.36,1
[Law books],KM1,KP 19.M,1.35,1
[Law books],KP 19.N,KRA 395.G,1M.35,1M
[Law books],KRA 395.G,KX 111.L,1M.36,1M
[Law books],KX 114.W,KZ 224.1,1M.37,1M
[Law books],KZ 703.1,KZD 9999,1M.36-1M.35,1M
[Humanities books] E-Z,E1,E 840.8,2M.13-2M.16,2M
[Humanities books] E-Z,E1,E467.1,2M.16,2M
[Humanities books] E-Z,E 468.C,E744.F,2M.14,2M
[Humanities books] E-Z,E744.F,E840.8,2M.13,2M
[Humanities books] E-Z,E 841,GE 42.P,2.13,2
[Humanities books] E-Z,E 841,HC 241.2,2.13-2.14,2
[Humanities books] E-Z,GE 42.S,HC 59.7,2.14,2
[Humanities books] E-Z,HC 59.7,HC 241.2,2.13,2
[Humanities books] E-Z,HC 241.2,HC 257.W,2.44,2
[Humanities books] E-Z,HC 241.2,P9999,2.43-2.51,2
[Humanities books] E-Z,HC 258.B,HD 2785.W,2.43,2
[Humanities books] E-Z,HD 2791.K,HD 6052.W,2.44,2
[Humanities books] E-Z,HD 6053,HD 7287.5,2.45,2
[Humanities books] E-Z,HD 7287.6,HD 8943.S,2.46,2
[Humanities books] E-Z,HD 9000.D,HD 9753.U,2.47,2
[Humanities books] E-Z,HD 9744,HF 1359.B,2.48,2
[Humanities books] E-Z,HF 1359.B,HF 1411.F,2.49,2
[Humanities books] E-Z,HF 1411.G,HF 3778.G,2.50,2
[Humanities books] E-Z,HF 3785.T,HN 398.E,2.51,2
[Humanities books] E-Z,HN 398.E,HT 153.L,2.50,2
[Humanities books] E-Z,HT 153.R,HX 56.W,2.49,2
[Humanities books] E-Z,HX 72.S,JK 468.1,2.48,2
[Humanities books] E-Z,JK 468.1,JQ 5995,2.47,2
[Humanities books] E-Z,JS 67,ML 410.V,2.46,2
[Humanities books] E-Z,ML 422.B,NE 9999,2.45,2
[Humanities books] E-Z,NK 1,P 9999,2.44,2
[Humanities books] E-Z,PA1,PA 6392.H,2M.43-2M.51,2M
[Humanities books] E-Z,PA1,PA 3611.L,2M.43,2M
[Humanities books] E-Z,PA 3611.L,PA 4226.Z,2M.51,2M
[Humanities books] E-Z,PA 4227.E,PA 4336.G,2M.50,2M
[Humanities books] E-Z,PA 4360.C,PA 5284,2M.49,2M
[Humanities books] E-Z,PA 5285.B,PA 5610.R,2M.48,2M
[Humanities books] E-Z,PA 5610.S,PA 5612.X,2M.47,2M
[Humanities books] E-Z,PA 5613,PA 6120,2M.46,2M
[Humanities books] E-Z,PA 6121,PA 6296.D,2M.45,2M
[Humanities books] E-Z,PA 6296.D,PA 6392.H,2M.44,2M
[Humanities books] E-Z,PA 6393.A,PA 6568.C,2.56,2
[Humanities books] E-Z,PA 6393.A,PQ 645.S,2.54-2.59,2
[Humanities books] E-Z,PA 6568.C,PA 6716.M,2.55,2
[Humanities books] E-Z,PA 6716.P,PA 8502.E,2.54,2
[Humanities books] E-Z,PA 8502.E,PN 94.6,2.55,2
[Humanities books] E-Z,PN 98.M,PN 1993.4,2.56,2
[Humanities books] E-Z,PN 1993.5.A,PN 1993.5.S,2.58,2
[Humanities books] E-Z,PN 1993.5.S,PN 1995.C,2.57,2
[Humanities books] E-Z,PN 1995.9,PN 1998.3,2.58,2
[Humanities books] E-Z,PN 1998.3,PQ 295.D,2.59,2
[Humanities books] E-Z,PQ 245.B,PQ 645.S,2.58,2
[Humanities books] E-Z,PQ 648.B,PQ 6606,2M.54-2M.59,2M
[Humanities books] E-Z,PQ 648.B,PQ 1779.T,2M.58,2M
[Humanities books] E-Z,PQ 1781.D,PQ 2242.R,2M.59,2M
[Humanities books] E-Z,PQ 2246,PQ 2436.S,2M.58,2M
[Humanities books] E-Z,PQ 2438.G,PQ 2603.U,2M.56,2M
[Humanities books] E-Z,PQ 2605,PQ 2606,2M.55,2M
[Humanities books] E-Z,PQ 2607,PQ 2638.L,2M.54,2M
[Humanities books] E-Z,PQ 2639,PQ 6389.P,2M.55,2M
[Humanities books] E-Z,PQ 6390.E,PQ 6606,2M.56,2M
[Humanities books] E-Z,PQ 6607,PQ 6623.A79,2.64,2
[Humanities books] E-Z,PQ 6607.E,PT 1479.R,2.62-2.71,2
[Humanities books] E-Z,PQ 6623.A8,PQ 7297,2.63,2
[Humanities books] E-Z,PQ 7298,PQ 8497.A,2.62,2
[Humanities books] E-Z,PQ 8497.B,PQ 9261.M69,2.63,2
[Humanities books] E-Z,PQ 9261.M7,PQ 9697.S,2.62,2
[Humanities books] E-Z,PQ 9697.T,PR 99,2.63,2
[Humanities books] E-Z,PR 100,PR 549,2.64,2
[Humanities books] E-Z,PR 550,PR 929,2.66,2
[Humanities books] E-Z,PR 930,PR 1149,2.67,2
[Humanities books] E-Z,PR 1150,PR 1579,2.69,2
[Humanities books] E-Z,PR 1580,PR 2009,2.70,2
[Humanities books] E-Z,PR 2010,PR 3522.F,2.71,2
[Humanities books] E-Z,PR 3522.G,PR 4965,2.70,2
[Humanities books] E-Z,PR 4966,PR 6019.O9.24,2.69,2
[Humanities books] E-Z,PR 6019.O9.Z5,PR 6054,2.68,2
[Humanities books] E-Z,PR 6055,PS 3545.L,2.67,2
[Humanities books] E-Z,PS 3545.M,PT 1099,2.66,2
[Humanities books] E-Z,PT 1100,ZA 9999,2M.62-2M.72,2M
[Humanities books] E-Z,PT 1100,PT 1567,2M.65,2M
[Humanities books] E-Z,PT 1568,PT 1892,2M.64,2M
[Humanities books] E-Z,PT 1893,PT 2360,2M.63,2M
[Humanities books] E-Z,PT 2361,PT 2467,2M.62,2M
[Humanities books] E-Z,PT 2468,PT 2616,2M.63,2M
[Humanities books] E-Z,PT 2617,PT 2625.A44.Z48,2M.62,2M
[Humanities books] E-Z,PT 2625.A44.249,PT 2638.M,2M.63,2M
[Humanities books] E-Z,PT 2638.N,PT 2685.O36.24,2M.64,2M
[Humanities books] E-Z,PT 2685.O36.25,PZ 9999,2M.65,2M
[Humanities books] E-Z,U1,U27.K,2M.72,2M
[Humanities books] E-Z,U 27.L,U815.K,2M.71,2M
[Humanities books] E-Z,U 815.L,UA 831.D,2M.70,2M
[Humanities books] E-Z,UA 831.E,UB 251.U5.G,2M.69,2M
[Humanities books] E-Z,UB 251.U5.H,UG 630.R,2M.68,2M
[Humanities books] E-Z,UG 630.S,Z 1008.0,2M.67,2M
[Humanities books] E-Z,Z 1008.0,ZA 9999,2M.66,2M
[Science books],Q1,QA 76.G,2.35,2
[Science books],QA 76.H,QA 76.9,2.36,2
[Science books],QA 76.9,QA 267.L,2.37,2
[Science books],QA 267.M,QA 303.R,2.38,2
[Science books],QA 303.S,QA 326.M,2.37,2
[Science books],QA 326.N,QA 351.0,2.36,2
[Science books],QA 351.R,QA 387.2,2.35,2
[Science books],QA 400,QC 61.L,2M.35-2M.37,2M
[Science books],QA 400,QA 471.H,2M.35,2M
[Science books],QA 471.M,QA 802.2,2M.36,2M
[Science books],QA 803.C,QC 6.C,2M.37,2M
[Science books],QC 6.D,QC 20.6,2M.36,2M
[Science books],QC 20.7,QC 61.L,2M.35,2M
[Science books],QC 70,QC 278.W,2.40,2
[Science books],QC 280,QC 670.R,2.41,2
[Science books],QC 670.S,QE 665,2.42,2
[Science books],QE 681.A,QU 9999,2.41,2
[Science books],R1,R 855.3,2.41,2
[Science books],R 855.3,RA 441.B,2.40,2
[Science books],RA 441.C,TX 9999,2M.39-2M.42,2M
[Science books],RA 441.C,RC 552.E,2M.40,2M
[Science books],RC 552.P,TD 892.L,2M.39,2M
[Science books],TD 892.R,TJ 755.G,2M.40,2M
[Science books],TJ 755.G,TK 5102.5,2M.41,2M
[Science books],TK 5102.5,TK 7882.S,2M.42,2M
[Science books],TK 7882.S,TX 9999,2M.41,2M
[Humanities books] Folio & Outsize,FOL A 1,ZA 9999,2M.17-2M.20,2M
[Humanities books] Folio & Outsize,FOL A 1,BR 60.M58,2M.20,2M
[Humanities books] Folio & Outsize,FOL. BR 60.M58,BR 70.08,2M.19,2M
[Humanities books] Folio & Outsize,FOL. BR 70.CB,N 6853.P,2M.18,2M
[Humanities books] Folio & Outsize,FOL. N 6860,ND 145.B,2M.17,2M
[Humanities books] Folio & Outsize,FOL ND 170.N,PA 3309,2M.18,2M
[Humanities books] Folio & Outsize,FOL. PA 3315.0,UA 23.S,2M.19,2M
[Humanities books] Folio & Outsize,FOL UA 23.2,ZA 9999,2M.20,2M
[Humanities books] Folio & Outsize,OUTSIZE A 1,ZA 9999,2M.12-2M.13,2M
[Humanities books] Folio & Outsize,OUTSIZE A 1,CN 520.0,2M.13,2M
[Humanities books] Folio & Outsize,OUTSIZE CN 520.C,ZA 9999,2M.12,2M
[Humanities books] Folio & Outsize,Atlases,,2M.12,2M`;

        let libraryData = []; // This will hold our parsed library data.

        // Get references to our HTML elements
        const findButton = document.getElementById('findButton');
        const classmarkInput = document.getElementById('classmarkInput');
        const statusArea = document.getElementById('statusArea');
        const resultArea = document.getElementById('resultArea');
        const imageModal = document.getElementById('imageModal');
        const modalImage = document.getElementById('modalImage');
        const modalContent = document.getElementById('modalContent');


        // --- 2. DATA PARSING ---

        /**
         * Parses the embedded CSV data.
         */
        function loadLibraryData() {
            try {
                // Parse the CSV text into an array of objects
                libraryData = Papa.parse(CSV_DATA, { header: true, skipEmptyLines: true }).data;
                console.log('Library data loaded:', libraryData);
            } catch (error) {
                console.error('Failed to parse library data:', error);
                statusArea.textContent = 'Error: Could not parse library data.';
                statusArea.classList.add('text-red-500');
            }
        }
        
        // Use PapaParse library for robust CSV parsing
        function loadPapaParse(callback) {
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js';
            script.onload = callback;
            script.onerror = () => {
                statusArea.textContent = 'Error: Could not load data parser. Please check your internet connection.';
                statusArea.classList.add('text-red-500');
            };
            document.head.appendChild(script);
        }

        // --- 3. CORE SEARCH LOGIC ---

        /**
         * Normalizes a classmark string for reliable alphanumeric comparison.
         * It removes spaces and pads numbers with leading zeros.
         * e.g., "DA 560.E" -> "DA000560.E"
         * @param {string} str - The classmark string.
         * @returns {string} - The normalized string.
         */
        function normalizeForSort(str) {
            if (!str || typeof str !== 'string') return '';
            // Remove spaces, then find all numbers and pad them with leading zeros to a fixed length.
            // This ensures that "DA 60" comes before "DA 560" in a standard string sort.
            return str.toUpperCase().replace(/\s/g, '').replace(/(\d+)/g, num => num.padStart(6, '0'));
        }

        /**
         * Finds the location for a given classmark.
         * @param {string} userInput - The classmark entered by the user.
         * @returns {object|null} - The matching row from the data or null if not found.
         */
        function findBookLocation(userInput) {
            const normalizedInput = normalizeForSort(userInput);
            if (!normalizedInput) return null;
             
            // First pass: check for exact matches on items with no range.
            for (const row of libraryData) {
                const begin = normalizeForSort(row.Beg);
                const end = normalizeForSort(row.End);

                if (!end && normalizedInput === begin) {
                    return row; // Exact match found for single-entry classmark
                }
            }

            // Second pass: check for range matches.
            for (const row of libraryData) {
                const begin = normalizeForSort(row.Beg);
                const end = normalizeForSort(row.End);
                
                if (end && normalizedInput >= begin && normalizedInput <= end) {
                    return row; // Match found in range!
                }
            }

            return null; // No match found
        }

        // --- 4. DISPLAY AND EVENT HANDLING ---

        /**
         * Opens the modal to display the zoomed-in image.
         * @param {string} src - The image source URL.
         */
        function openModal(src) {
            modalImage.setAttribute('src', src);
            imageModal.classList.remove('hidden');
            // Animate in
            setTimeout(() => {
                imageModal.classList.remove('bg-opacity-0');
                imageModal.classList.add('bg-opacity-75');
                modalContent.classList.remove('zoom-out', 'zoom-in');
                modalContent.classList.add('zoom-in');
            }, 10); // A tiny delay to allow the browser to render the element before animating
        }

        /**
         * Closes the image modal with an animation.
         */
        function closeModal() {
            imageModal.classList.remove('bg-opacity-75');
            imageModal.classList.add('bg-opacity-0');
            modalContent.classList.remove('zoom-in');
            modalContent.classList.add('zoom-out');
            
            // Wait for the animation to complete before hiding the modal
            setTimeout(() => {
                imageModal.classList.add('hidden');
            }, 300); // Must match the animation duration in CSS
        }

        /**
         * Displays the search result on the page.
         * @param {object|null} result - The result object from the search.
         */
        function displayResult(result) {
            resultArea.innerHTML = ''; // Clear previous results
            if (!result) {
                resultArea.innerHTML = `
                    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg fade-in" role="alert">
                        <p class="font-bold">Not Found</p>
                        <p>We couldn't find a location for that classmark. Please check for typos.</p>
                    </div>
                `;
                return;
            }
            
            let imagePath = '';
            const floor = result.Floor;
            if (floor === '1') {
                imagePath = 'https://raw.githubusercontent.com/alexlepheno/libo/cd3fd65b190f7dc63af2e59096cb7e5569c3ac48/floor-plan-1.jpg';
            } else if (floor === '1M') {
                imagePath = 'https://raw.githubusercontent.com/alexlepheno/libo/cd3fd65b190f7dc63af2e59096cb7e5569c3ac48/floor-plan-1M.png';
            } else if (floor === '2') {
                imagePath = 'https://raw.githubusercontent.com/alexlepheno/libo/cd3fd65b190f7dc63af2e59096cb7e5569c3ac48/floor-plan-2.jpg';
            } else if (floor === '2M') {
                imagePath = 'https://raw.githubusercontent.com/alexlepheno/libo/cd3fd65b190f7dc63af2e59096cb7e5569c3ac48/floor-plan-2M.jpg';
            }

            resultArea.innerHTML = `
                <div class="bg-green-100 border-l-4 border-green-500 p-6 rounded-lg shadow-sm fade-in">
                    <div class="md:grid md:grid-cols-2 md:gap-6 items-start">
                        <div>
                            <h2 class="text-xl font-bold text-gray-800 mb-4">Location Found!</h2>
                            <div class="space-y-2">
                                <p><strong class="w-24 inline-block text-gray-600">Room(s):</strong> <span class="text-2xl font-bold text-green-700">${result['Room(s)'] || 'N/A'}</span></p>
                                <p><strong class="w-24 inline-block text-gray-600">Collection:</strong> <span class="font-medium text-gray-700">${result.Subject || 'N/A'}</span></p>
                                <p><strong class="w-24 inline-block text-gray-600">Floor:</strong> <span class="font-medium text-gray-700">${result.Floor || 'N/A'}</span></p>
                            </div>
                        </div>
                        ${imagePath ? `
                        <div class="mt-4 md:mt-0">
                            <h3 class="font-semibold text-gray-700 mb-2">Floor Plan (${result.Floor})</h3>
                            <img src="${imagePath}" alt="Floor plan for floor ${result.Floor}" class="rounded-lg shadow-md border w-full h-auto cursor-pointer hover:opacity-90 transition-opacity">
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;

            // Attach click listener to the new image for the modal
            const floorPlanImage = resultArea.querySelector('img');
            if (floorPlanImage) {
                floorPlanImage.addEventListener('click', () => {
                    openModal(floorPlanImage.src);
                });
            }
        }
        
        /**
         * Main search handler function.
         */
        function performSearch() {
            const query = classmarkInput.value.trim();
            if (!query) {
                statusArea.textContent = 'Please enter a classmark.';
                return;
            }
            statusArea.textContent = '';
            const location = findBookLocation(query);
            displayResult(location);
        }

        // Attach event listeners
        findButton.addEventListener('click', performSearch);
        classmarkInput.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                performSearch();
            }
        });
        
        // Listener to close the modal
        imageModal.addEventListener('click', (e) => {
            // Close only if the click is on the background, not the image itself
            if (e.target === imageModal) {
                closeModal();
            }
        });


        // --- 5. INITIALIZATION ---
        // Load the CSV parser, then load the library data.
        loadPapaParse(loadLibraryData);

    </script>
</body>
</html>
